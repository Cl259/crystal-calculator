<!doctype html>
<html lang="zh-TW" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>立客印水晶貼計算器</title>

  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Nunito:wght@800;900&display=swap" rel="stylesheet">

  <style>
    /* --- 全域變數定義：藍色系吉祥物風格 --- */
    :root {
      --bg-color: #eef7f9;       /* 整體柔和淺藍背景 */
      --card-bg: #ffffff;        /* 卡片白色背景 */
      --primary-blue: #4298b5;   /* 主色調：吉祥物身體的藍綠色 */
      --secondary-blue: #c0e4ed; /* 次要色調：淺藍色裝飾 */
      --accent-coral: #f28b82;   /* 點綴色：吉祥物腮紅/畫筆的珊瑚色 */
      --text-dark: #2c4f5e;      /* 深色文字：取代純黑，使用深藍灰色 */
      
      --border-radius-xl: 28px;  /* 超大圓角 */
      --border-radius-lg: 18px;  /* 大圓角 */
      --border-radius-md: 12px;  /* 中圓角 */
      --border-width: 4px;       /* 粗邊框寬度 */
    }

    body {
      box-sizing: border-box;
      min-height: 100vh;
      background: var(--bg-color);
      font-family: 'Noto Sans TC', sans-serif;
      color: var(--text-dark);
      overflow-x: hidden;
      position: relative;
    }

    /* --- 吉祥物背景裝飾 --- */
    .mascot-bg {
        position: fixed;
        /* 設定吉祥物位置，這裡放在右下角 */
        bottom: 2%;
        right: -5%;
        width: 350px; /* 根據需要調整大小 */
        height: auto;
        z-index: 0;
        pointer-events: none; /* 確保不擋住操作 */
        opacity: 0.9;
        animation: floatMascot 5s ease-in-out infinite;
    }

    /* 吉祥物上下晃動動畫 */
    @keyframes floatMascot {
      0%, 100% { transform: translateY(0) rotate(2deg); }
      50% { transform: translateY(-20px) rotate(-2deg); }
    }

    /* --- 主要卡片風格重塑 (Cute Block Style) --- */
    .line-card {
      background: var(--card-bg);
      /* 改為圓潤粗藍色邊框 */
      border: var(--border-width) solid var(--primary-blue);
      border-radius: var(--border-radius-xl);
      position: relative;
      z-index: 10;
      /* 柔和的藍色色塊陰影 */
      box-shadow: 0 10px 0px var(--secondary-blue);
      transition: all 0.3s ease;
      overflow: hidden; /* 確保內部圓角 */
    }

    /* --- 輸入框風格 --- */
    .line-input {
      width: 100%;
      background: #f4fdff; /* 極淺的藍底 */
      border: 3px solid var(--secondary-blue);
      padding: 14px 18px;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
      border-radius: var(--border-radius-md);
      transition: all 0.2s;
    }

    .line-input:focus {
      outline: none;
      background: #ffffff;
      border-color: var(--primary-blue);
      /* 聚焦時的柔和光暈 */
      box-shadow: 0 0 0 5px rgba(66, 152, 181, 0.2);
    }

    /* 下拉選單箭頭替換為藍色圓潤版 */
    select.line-input {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234298b5' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 1.2rem center;
      background-size: 1.4em;
      cursor: pointer;
    }

    /* 標籤樣式 */
    .line-label {
      display: block;
      margin-bottom: 10px;
      font-weight: 800;
      font-size: 1rem;
      letter-spacing: 0.02em;
      color: var(--primary-blue); /* 標籤改為藍色 */
    }

    /* Admin 標籤樣式調整 */
    .admin-badge {
        background-color: var(--accent-coral) !important; /* 改為珊瑚色 */
        padding: 4px 10px !important;
    }

    /* --- 標題樣式 (圓潤粗體) --- */
    .art-title {
      font-family: 'Nunito', sans-serif; /* 使用圓潤字體 */
      font-weight: 900;
      font-style: normal;
      color: var(--primary-blue);
      text-shadow: none; /* 移除舊陰影 */
      letter-spacing: -0.03em;
    }

    /* 副標題 Tagline 樣式重塑 */
    #tagline {
        background-color: var(--secondary-blue);
        color: var(--text-dark);
        font-weight: 800;
        border: none;
        border-radius: 99px; /* 膠囊狀 */
        padding: 8px 24px;
        transform: none; /* 移除傾斜 */
        box-shadow: 0 4px 0 rgba(66, 152, 181, 0.2);
    }

    /* 分隔線 */
    .line-divider {
      height: 4px;
      background: var(--secondary-blue); /* 淺藍色分隔線 */
      margin: 2.5rem 0;
      border-radius: 99px;
      opacity: 0.5;
    }

    /* --- 計算明細區塊 --- */
    .detail-box {
        background-color: #fdfdfd;
        border: 3px solid var(--secondary-blue);
        border-radius: var(--border-radius-lg);
    }

    .detail-title-deco {
        width: 16px;
        height: 16px;
        background-color: var(--accent-coral); /* 珊瑚色裝飾點 */
        border-radius: 50%;
        border: none;
        box-shadow: 0 3px 0 rgba(0,0,0,0.1);
    }

    .result-item {
      border-bottom: 2px dashed var(--secondary-blue); /* 淺藍虛線 */
      padding: 14px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .result-item:last-child {
      border-bottom: none;
    }

    /* --- 最終報價區塊 --- */
    .final-price-box {
      background: var(--primary-blue); /* 深藍色背景 */
      color: #ffffff;
      padding: 32px;
      margin-top: 24px;
      border: none;
      border-radius: var(--border-radius-xl);
      position: relative;
      box-shadow: inset 0 -6px 0 rgba(0,0,0,0.1); /* 內部立體感 */
      overflow: hidden;
    }
    
    /* 報價區塊內的裝飾波紋 (可選) */
    .final-price-box::after {
        content: '';
        position: absolute;
        bottom: -20%;
        left: -10%;
        width: 120%;
        height: 40%;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
        z-index: 0;
    }
    .final-price-content {
        position: relative;
        z-index: 1;
    }

    /* 覆蓋 Tailwind 的文字顏色 */
    .text-yellow-400 { color: var(--secondary-blue) !important; }
    .text-gray-500 { color: var(--primary-blue) !important; opacity: 0.8; }
    .text-gray-600 { color: var(--text-dark) !important; opacity: 0.7; }
    
    /* 最終價格大字 */
    #output-j {
        color: #fff !important;
        text-shadow: 0 4px 0 rgba(0,0,0,0.1) !important;
        font-family: 'Nunito', sans-serif;
    }
    
    /* 底部文字 */
    .footer-text {
        color: var(--primary-blue) !important;
        opacity: 0.6;
    }

  </style>

  <style>
    @view-transition { navigation: auto; }
  </style>
</head>
<body class="h-full">

  <img src="image_1.png" alt="Mascot" class="mascot-bg">

  <div id="app" class="w-full h-full overflow-auto relative z-10">
    <div class="min-h-full w-full py-12 px-4 flex flex-col items-center">

      <div class="max-w-4xl w-full text-center mb-12 relative">
        <h1 id="app-title" class="art-title text-5xl md:text-7xl mb-6 tracking-tight">
          立客印水晶貼
        </h1>
        <p id="tagline" class="text-lg md:text-xl inline-block px-6">
          專業水晶貼紙快速報價 · 精準又簡單
        </p>
        <p id="delivery-note" class="mt-6 text-sm font-bold tracking-wider uppercase">
          /// 交貨方式：一大張內多小張 ///
        </p>
      </div>

      <div class="max-w-4xl w-full">
        <div class="line-card p-8 md:p-12">
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div>
              <label class="line-label" id="length-label">貼紙長 (mm)</label>
              <input type="number" id="input-a" value="10" min="1" class="line-input">
            </div>

            <div>
              <label class="line-label" id="width-label">貼紙寬 (mm)</label>
              <input type="number" id="input-b" value="10" min="1" class="line-input">
            </div>

            <div>
              <label class="line-label" id="quantity-label">貼紙數量 (pcs)</label>
              <input type="number" id="input-c" value="100" min="1" class="line-input">
            </div>

            <div>
              <label class="line-label" id="material-label">材質選擇</label>
              <select id="input-d" class="line-input">
                <option value="ab">AB 膜</option>
                <option value="gold">燙金直噴膜</option>
              </select>
            </div>

            <div class="md:col-span-2">
              <label class="line-label flex items-center gap-3" id="multiplier-label">
                乘數 (利潤倍數)
                <span class="text-xs text-white px-3 py-1 rounded-full admin-badge">Admin</span>
              </label>
              <input type="number" id="input-h" value="2.5" min="0.1" step="0.1" class="line-input">
            </div>
          </div>

          <div class="line-divider"></div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            
            <div class="space-y-2 p-8 detail-box">
              <h3 class="font-bold text-xl mb-6 flex items-center gap-3" style="color: var(--text-dark);">
                <span class="detail-title-deco block"></span>
                計算明細
              </h3>
              
              <div class="result-item">
                <span class="text-gray-600 font-bold" id="total-area-label">總才數 (才)</span>
                <span id="output-f" class="font-black text-2xl" style="color: var(--primary-blue);">0</span>
              </div>
              
              <div class="result-item">
                <span class="text-gray-600 font-bold" id="cost-label">成本</span>
                <span id="output-e" class="font-black text-2xl" style="color: var(--text-dark);">$0</span>
              </div>
              
              <div class="result-item">
                <span class="text-gray-600 font-bold" id="unit-cost-label">成本單價</span>
                <span id="output-g" class="font-black text-2xl" style="color: var(--text-dark);">$0</span>
              </div>
            </div>

            <div class="flex flex-col">
              <div class="final-price-box flex-grow flex flex-col justify-center items-center text-center">
                <div class="mb-8 w-full final-price-content">
                  <span class="block text-sm font-bold tracking-widest uppercase mb-2 opacity-80" id="unit-price-label">單價 Unit Price</span>
                  <span id="output-i" class="text-5xl font-black tracking-tighter">$0</span>
                </div>
                
                <div class="w-full pt-8 border-t border-white/20 final-price-content">
                  <span class="block text-xs font-bold tracking-widest uppercase mb-2 opacity-80" id="total-price-label">總金額 Total</span>
                  <span id="output-j" class="text-6xl md:text-7xl font-black tracking-tighter">$0</span>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="text-center mt-16 mb-6">
        <p class="text-sm font-bold tracking-widest uppercase footer-text">
          DESIGNED BY NISHITANI STYLE
        </p>
      </div>
    </div>
  </div>

  <script>
    const defaultConfig = {
      background_color: '#f2f4fa',
      surface_color: '#ffffff',
      text_color: '#0f172a',
      primary_action_color: '#2563eb',
      secondary_action_color: '#94a3b8',
      font_family: 'system-ui',
      font_size: 16,

      app_title: '立客印水晶貼計算公式',
      tagline: '專業水晶貼紙快速報價 · 精準又簡單',
      delivery_note: '交貨方式：一大張內多小張',

      length_label: '貼紙長（mm）',
      width_label: '貼紙寬（mm）',
      quantity_label: '貼紙數量（pcs）',
      material_label: '材質選擇',
      multiplier_label: '乘數（利潤倍數）',

      total_area_label: '總才數（才）',
      cost_label: '成本',
      unit_cost_label: '成本單價',
      unit_price_label: '售價單價',
      total_price_label: '售價總金額'
    };

    async function onConfigChange(config) {
      // 為了適應新風格，這裡僅保留文字內容的更新，樣式由 CSS 強制覆蓋
      
      document.getElementById('app-title').textContent =
        config.app_title || defaultConfig.app_title;
      document.getElementById('tagline').textContent =
        config.tagline || defaultConfig.tagline;
      
      const deliveryNote = document.getElementById('delivery-note');
      if (deliveryNote) {
        deliveryNote.textContent =
          config.delivery_note || defaultConfig.delivery_note;
      }

      document.getElementById('length-label').textContent =
        config.length_label || defaultConfig.length_label;
      document.getElementById('width-label').textContent =
        config.width_label || defaultConfig.width_label;
      document.getElementById('quantity-label').textContent =
        config.quantity_label || defaultConfig.quantity_label;
      document.getElementById('material-label').textContent =
        config.material_label || defaultConfig.material_label;
      // 這裡特別處理乘數標籤，保留 Admin 標記
      const multLabel = document.getElementById('multiplier-label');
      if(multLabel) {
         // 簡單替換文字節點，保留 span
         multLabel.childNodes[0].nodeValue = (config.multiplier_label || defaultConfig.multiplier_label) + " ";
      }

      document.getElementById('total-area-label').textContent =
        config.total_area_label || defaultConfig.total_area_label;
      document.getElementById('cost-label').textContent =
        config.cost_label || defaultConfig.cost_label;
      document.getElementById('unit-cost-label').textContent =
        config.unit_cost_label || defaultConfig.unit_cost_label;
      document.getElementById('unit-price-label').textContent =
        config.unit_price_label || defaultConfig.unit_price_label;
      document.getElementById('total-price-label').textContent =
        config.total_price_label || defaultConfig.total_price_label;
    }

    // 計算公式區 (完全未變動)
    function calculate() {
      const A = parseFloat(document.getElementById('input-a').value) || 10;
      const B = parseFloat(document.getElementById('input-b').value) || 10;
      const C = parseFloat(document.getElementById('input-c').value) || 100;
      const D = document.getElementById('input-d').value;
      const H = parseFloat(document.getElementById('input-h').value) || 2.5;

      const baseCalc1 = ((A + 10) * (B + 10) * C / 90000);
      const baseCalc2 = ((A + 1) * (B + 1) * C / 90000);

      const part1 = Math.ceil(baseCalc1);
      const part2 = Math.ceil(0.19 * baseCalc2);
      const F = part1 + part2;

      let E;
      if (D === 'ab') {
        E = (F * 100 < 450) ? 450 : F * 100;
      } else {
        E = (F * 200 < 650) ? 650 : F * 200;
      }

      const G = E / C;
      const I = Math.round(G * H * 10) / 10;
      const J = Math.round(I * C * 10) / 10;

      document.getElementById('output-f').textContent = `${F}`;
      document.getElementById('output-e').textContent = `$${E.toFixed(0)}`;
      document.getElementById('output-g').textContent = `$${G.toFixed(2)}`;
      document.getElementById('output-i').textContent = `$${I.toFixed(1)}`;
      document.getElementById('output-j').textContent = `$${J.toFixed(1)}`;
    }

    document.getElementById('input-a').addEventListener('input', calculate);
    document.getElementById('input-b').addEventListener('input', calculate);
    document.getElementById('input-c').addEventListener('input', calculate);
    document.getElementById('input-d').addEventListener('change', calculate);
    document.getElementById('input-h').addEventListener('input', calculate);

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [], // 鎖定顏色風格以維持藝術設計
          borderables: [],
          fontEditable: {},
          fontSizeable: {}
        }),
        mapToEditPanelValues: (config) => new Map([
          ['app_title', config.app_title || defaultConfig.app_title],
          ['tagline', config.tagline || defaultConfig.tagline],
          ['delivery_note', config.delivery_note || defaultConfig.delivery_note],
          ['length_label', config.length_label || defaultConfig.length_label],
          ['width_label', config.width_label || defaultConfig.width_label],
          ['quantity_label', config.quantity_label || defaultConfig.quantity_label],
          ['material_label', config.material_label || defaultConfig.material_label],
          ['multiplier_label', config.multiplier_label || defaultConfig.multiplier_label],
          ['total_area_label', config.total_area_label || defaultConfig.total_area_label],
          ['cost_label', config.cost_label || defaultConfig.cost_label],
          ['unit_cost_label', config.unit_cost_label || defaultConfig.unit_cost_label],
          ['unit_price_label', config.unit_price_label || defaultConfig.unit_price_label],
          ['total_price_label', config.total_price_label || defaultConfig.total_price_label]
        ])
      });
    }

    onConfigChange(window.elementSdk?.config || defaultConfig);
    calculate();
  </script>
</body>
</html>